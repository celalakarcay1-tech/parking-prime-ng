<div class="qr-container">
  <div class="qr-header">
    <h2>QR Kod Yönetimi</h2>
    <div class="header-actions">
      <div class="generate-section">
        <input 
          type="text" 
          pInputText 
          [(ngModel)]="newPlateNumber" 
          placeholder="Plaka numarası girin..."
          (keypress)="$event.key === 'Enter' && generateQRCode()"
          styleClass="mr-2" />
        <p-button 
          label="QR Kod Oluştur" 
          icon="pi pi-qrcode" 
          (onClick)="generateQRCode()">
        </p-button>
      </div>
    </div>
  </div>

  <!-- QR Kod Listesi -->
  <p-card class="table-card">
    <p-table 
      [value]="qrCodes" 
      [paginator]="true" 
      [rows]="10"
      styleClass="p-datatable-striped p-datatable-gridlines">
      
      <ng-template pTemplate="header">
        <tr>
          <th>Plaka</th>
          <th>QR Kod</th>
          <th>Oluşturulma Tarihi</th>
          <th>Durum</th>
          <th>İşlemler</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-qrCode>
        <tr>
          <td><strong>{{ qrCode.vehiclePlate }}</strong></td>
          <td><code>{{ qrCode.qrCode }}</code></td>
          <td>{{ qrCode.createdAt | date:'dd.MM.yyyy HH:mm' }}</td>
          <td>
            <p-tag 
              [value]="getStatusLabel(qrCode.status)" 
              [severity]="getStatusSeverity(qrCode.status)">
            </p-tag>
          </td>
          <td>
            <div class="action-buttons">
              <p-button 
                icon="pi pi-eye" 
                [rounded]="true"
                [text]="true"
                (onClick)="viewQRCode(qrCode)"
                pTooltip="Görüntüle"
                tooltipPosition="top">
              </p-button>
              <p-button 
                icon="pi pi-download" 
                [rounded]="true"
                [text]="true"
                [severity]="'success'"
                (onClick)="downloadQRCode(qrCode)"
                pTooltip="İndir"
                tooltipPosition="top">
              </p-button>
              <p-button 
                icon="pi pi-power-off" 
                [rounded]="true"
                [text]="true"
                [severity]="'warning'"
                (onClick)="toggleStatus(qrCode)"
                [pTooltip]="qrCode.status === 'active' ? 'Pasif Yap' : 'Aktif Yap'"
                tooltipPosition="top">
              </p-button>
              <p-button 
                icon="pi pi-trash" 
                [rounded]="true"
                [text]="true"
                [severity]="'danger'"
                (onClick)="deleteQRCode(qrCode)"
                pTooltip="Sil"
                tooltipPosition="top">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="empty-message">
            <div class="empty-content">
              <i class="pi pi-qrcode" style="font-size: 3rem; color: #ccc;"></i>
              <p>QR kod bulunamadı.</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <!-- QR Kod Görüntüleme Dialog -->
  <p-dialog 
    [(visible)]="displayDialog" 
    header="QR Kod Detayı"
    [modal]="true"
    [style]="{width: '400px'}"
    [closable]="true"
    *ngIf="selectedQRCode">
    
    <div class="qr-dialog-content">
      <div class="qr-code-display">
        <div class="qr-code-box">
          <i class="pi pi-qrcode" style="font-size: 8rem; color: #1976d2;"></i>
        </div>
        <h3>{{ selectedQRCode.qrCode }}</h3>
        <p><strong>Plaka:</strong> {{ selectedQRCode.vehiclePlate }}</p>
        <p><strong>Durum:</strong> 
          <p-tag 
            [value]="getStatusLabel(selectedQRCode.status)" 
            [severity]="getStatusSeverity(selectedQRCode.status)">
          </p-tag>
        </p>
        <p><strong>Oluşturulma:</strong> {{ selectedQRCode.createdAt | date:'dd.MM.yyyy HH:mm' }}</p>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button 
        label="İndir" 
        icon="pi pi-download" 
        (onClick)="downloadQRCode(selectedQRCode!)"
        styleClass="mr-2">
      </p-button>
      <p-button 
        label="Kapat" 
        icon="pi pi-times" 
        (onClick)="displayDialog = false"
        [outlined]="true">
      </p-button>
    </ng-template>
  </p-dialog>
</div>

