<div class="history-container">
  <div class="history-header">
    <h2>Giriş/Çıkış Geçmişi</h2>
  </div>

  <!-- Filtreler -->
  <p-card class="filter-card">
    <div class="filters">
      <div class="filter-group">
        <span class="p-input-icon-left">
          <i class="pi pi-search"></i>
          <input 
            type="text" 
            pInputText 
            [(ngModel)]="searchTerm" 
            placeholder="Plaka veya yer numarası ara..." 
            (input)="filterHistory()"
          />
        </span>
      </div>
      <div class="filter-group">
        <label>Başlangıç Tarihi</label>
        <p-calendar 
          [(ngModel)]="startDate" 
          [showIcon]="true"
          dateFormat="dd.mm.yy"
          (onSelect)="filterHistory()">
        </p-calendar>
      </div>
      <div class="filter-group">
        <label>Bitiş Tarihi</label>
        <p-calendar 
          [(ngModel)]="endDate" 
          [showIcon]="true"
          dateFormat="dd.mm.yy"
          (onSelect)="filterHistory()">
        </p-calendar>
      </div>
      <div class="filter-group">
        <p-button 
          label="Temizle" 
          icon="pi pi-filter-slash" 
          (onClick)="clearFilters()"
          [outlined]="true">
        </p-button>
      </div>
    </div>
  </p-card>

  <!-- Geçmiş Tablosu -->
  <p-card class="table-card">
    <p-table 
      [value]="filteredHistory" 
      [paginator]="true" 
      [rows]="10"
      [rowsPerPageOptions]="[5, 10, 25, 50, 100]"
      [virtualScroll]="filteredHistory.length > 1000"
      [virtualScrollItemSize]="46"
      styleClass="p-datatable-striped p-datatable-gridlines"
      [tableStyle]="{'min-width': '50rem'}">
      
      <ng-template pTemplate="header">
        <tr>
          <th>Plaka</th>
          <th>Yer Numarası</th>
          <th>Giriş Saati</th>
          <th>Çıkış Saati</th>
          <th>Süre</th>
          <th>Tutar</th>
          <th>Ödeme Yöntemi</th>
          <th>Durum</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-record>
        <tr>
          <td><strong>{{ record.vehiclePlate }}</strong></td>
          <td>{{ record.spotNumber || '-' }}</td>
          <td>{{ record.entryTime | date:'dd.MM.yyyy HH:mm' }}</td>
          <td>
            <span *ngIf="record.exitTime">{{ record.exitTime | date:'dd.MM.yyyy HH:mm' }}</span>
            <span *ngIf="!record.exitTime" class="no-exit">-</span>
          </td>
          <td>
            <span *ngIf="record.duration">{{ record.duration }} saat</span>
            <span *ngIf="!record.duration">-</span>
          </td>
          <td>
            <span *ngIf="record.amount"><strong>{{ record.amount | currency:'TRY':'symbol':'1.2-2' }}</strong></span>
            <span *ngIf="!record.amount">-</span>
          </td>
          <td>{{ record.paymentMethod || '-' }}</td>
          <td>
            <p-tag 
              [value]="getStatusLabel(record.status)" 
              [severity]="getStatusSeverity(record.status)">
            </p-tag>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8" class="empty-message">
            <div class="empty-content">
              <i class="pi pi-inbox" style="font-size: 3rem; color: #ccc;"></i>
              <p>Kayıt bulunamadı.</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

